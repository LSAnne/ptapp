<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Trainer Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    
    :root{
      --bg:#0b0d10; --panel:#141820; --text:#eaf2f9; --muted:#92a4b6;
      --primary:#3b82f6; --danger:#ef4444; --success:#22c55e; --border:#283142;
    }
    body{ background:var(--bg); color:var(--text); }
    .navbar{ background:#0a0f16 !important; border-bottom:1px solid var(--border); }
    .card,.table{ background:var(--panel); border:1px solid var(--border); color:var(--text); }
    .table thead{ background:#1b2230; }
    .form-control,.form-select{ background:#0f141b; border:1px solid #2a3344; color:var(--text); }
    .form-control:focus,.form-select:focus{ border-color:#22c55e; box-shadow:0 0 0 .2rem #22c55e33; }
    .btn-primary{ background:var(--primary); border-color:var(--primary); }
    .btn-graphs{ background:var(--danger); color:#fff; border:0; }
    .btn-graphs:focus{ box-shadow:0 0 0 .2rem #ef444433; }
    .btn-session{ background:var(--success); color:#002408; border:0; font-weight:600; }
    .btn-session:focus{ box-shadow:0 0 0 .2rem #22c55e33; }
    .btn-outline-light{ border-color:#516279; color:#d8e7f6; }
    .btn-outline-light:hover{ background:#223044; }
    a.link{ color:#a6c8ff; text-decoration:underline dotted; }
    .small-muted{ color:#9fb3c8; font-size:.9rem; }
    
  </style>
</head>
<body>
  <nav class="navbar navbar-dark">
    <div class="container-fluid">
      <a class="navbar-brand fw-semibold" href="index.html">PT Portal · Trainer</a>
      <div class="d-flex gap-2">
        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#createClientModal">＋ Create Client</button>
        <button id="logoutBtn" class="btn btn-sm btn-outline-light">Sign out</button>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <div class="d-flex flex-wrap justify-content-between align-items-end gap-3 mb-3">
      <div>
        <h1 class="h3 m-0">Trainer Dashboard</h1>
        <div id="whoami" class="small-muted"></div>
      </div>
      <div style="min-width:280px;">
        <label for="search" class="form-label small mb-1">Search clients</label>
        <input id="search" type="search" class="form-control form-control-sm" placeholder="Type name or email…">
      </div>
    </div>

    <div id="status" class="small-muted mb-3">Loading clients…</div>

    <div class="card">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0" id="clientTable" style="display:none;">
          <thead>
          <tr>
            <th style="width:25%">Name</th>
            <th style="width:25%">Email</th>
            <th style="width:15%">Last workout</th>
            <th style="width:15%">Last check-in</th>
            <th style="width:20%" class="text-end">Actions</th>
          </tr>
          </thead>
          <tbody id="clientBody"></tbody>
        </table>
      </div>
      <div id="emptyState" class="p-4 text-center small-muted" style="display:none;">
        No clients linked yet.
      </div>
    </div>
  </main>

  <!-- Create Client Modal -->
  <div class="modal fade" id="createClientModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form class="modal-content" id="createClientForm">
        <div class="modal-header">
          <h5 class="modal-title">Create New Client</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="createError" class="alert alert-danger py-2 px-3 d-none"></div>
          <div id="createOk" class="alert alert-success py-2 px-3 d-none"></div>
          <div class="mb-3">
            <label class="form-label">Full name</label>
            <input id="newFullName" class="form-control" placeholder="Alex Example" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input id="newEmail" type="email" class="form-control" placeholder="alex@example.com" required>
            <div class="small-muted mt-1">Client may receive confirmation/sign-in email per your auth settings.</div>
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input id="newPassword" type="password" class="form-control" placeholder="Temporary password" required>
          </div>
        </div>
        <div class="modal-footer">
          <button id="createBtn" class="btn btn-primary" type="submit">Create client</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Graphs Modal -->
  <div class="modal fade" id="graphsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="background:#141820; border:1px solid #283142;">
        <div class="modal-header">
          <h5 id="graphsTitle" class="modal-title">Progress charts</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="graphsError" class="alert alert-danger py-2 px-3 d-none"></div>
          <div class="mb-3"><canvas id="weightChart" height="160"></canvas></div>
          <div><canvas id="activityChart" height="160"></canvas></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Plan New Session Modal -->
  <div class="modal fade" id="newSessionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <form class="modal-content" id="newSessionForm">
        <div class="modal-header">
          <h5 class="modal-title">Plan New Session</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="sessionError" class="alert alert-danger py-2 px-3 d-none"></div>
          <div class="row g-3 mb-2">
            <div class="col-12 col-md-6">
              <label class="form-label">Client</label>
              <select id="sessionClient" class="form-select" required></select>
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">Date</label>
              <input id="sessionDate" type="date" class="form-control" required>
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">Default RPE (optional)</label>
              <input id="sessionRpe" type="number" step="0.5" min="1" max="10" class="form-control" placeholder="e.g. 7.5">
            </div>
          </div>
          <label class="form-label">Exercises (one per line)</label>
          <textarea id="sessionLines" class="form-control" rows="8" placeholder="Hip Thrust, 4, 12, 60, tempo 3-1-1
RDL, 3, 8, 50
Walking Lunge, 3, 10, 20"></textarea>
          <div class="small-muted mt-2">Format: <em>Exercise, Sets, Reps, Weight, Notes</em>. Weight/Notes optional. RPE uses default above.</div>
        </div>
        <div class="modal-footer">
          <button id="planBtn" class="btn btn-session" type="submit">Create session</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Latest Session Modal -->
  <div class="modal fade" id="latestSessionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="background:#913263; border:1px solid #283142;">
        <div class="modal-header">
          <h5 class="modal-title">Latest Session</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="latestError" class="alert alert-danger py-2 px-3 d-none"></div>
          <div id="latestToolbar" class="d-flex gap-2 mb-2 d-none">
            <button id="latestCsv" class="btn btn-outline-light btn-sm">Export CSV</button>
            <button id="latestPrint" class="btn btn-outline-light btn-sm">Print</button>
          </div>
          <div id="latestBody"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- vendor libs -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- your app JS (external to avoid parser issues) -->
  <script src="trainer-dashboard.js"></script>
</body>
</html>